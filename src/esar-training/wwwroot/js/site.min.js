function getParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}angular.module("esarTraining",["ngMessages","ngMaterial","jkAngularCarousel"]).config(["$mdThemingProvider","$mdDateLocaleProvider",function(n,t){n.definePalette("sar-yellow",{"50":"#ffffff","100":"#fce7c6","200":"#f9d190","300":"#f6b44c","400":"#f4a82f","500":"#f39c12","600":"#db8b0b","700":"#be780a","800":"#a16608","900":"#845307",A100:"#ffffff",A200:"#fce7c6",A400:"#f4a82f",A700:"#be780a",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 400 A100 A200 A400 A700"}).definePalette("sar-green",{"50":"#97ffb1","100":"#4bff77","200":"#13ff4d","300":"#00ca32","400":"#00ac2b","500":"#008d23","600":"#006e1b","700":"#005014","800":"#00310c","900":"#001305",A100:"#97ffb1",A200:"#008d23",A400:"#00ac2b",A700:"#005014",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 A100 A200"});n.theme("default").primaryPalette("sar-green").accentPalette("sar-yellow").backgroundPalette("grey");t.parseDate=function(n){var t=moment(n,["YYYY-MM-DD","M/D/YYYY"],!0);return t.isValid()?t.toDate():new Date(NaN)}}]);angular.module("esarTraining").directive("serverError",function(){return{restrict:"A",require:"?ngModel",link:function(n,t,i,r){return t.on("change keyup",function(){return n.$apply(function(){return r.$setValidity("server",!0)})})}}}).directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(n,t,i,r){r.$validators.compareTo=function(t){return t==n.otherModelValue};n.$watch("otherModelValue",function(){r.$validate()})}}}).directive("usernameAvailableValidator",["$q","$http",function(n,t){return{require:"ngModel",link:function(i,r,u,f){f.$asyncValidators.usernameAvailable=function(i){var r=n.defer();return t.get(authApi+"/checkusername/"+encodeURIComponent(i)).then(function(n){console.log(n.data);n.data=="Available"?r.resolve():r.reject()}),r.promise}}}}]).controller("HomeCtrl",["$scope",function(n){n.pics=[{src:"/images/can2-checkin.jpg"},{src:"/images/litter-wheel.jpg"},{src:"/images/in-the-woods.jpg"},{src:"/images/team-evac.jpg"}]}]).controller("SignupCtrl",["$scope","$http","$window","$mdDialog",function(n,t,i,r){var u=n,f=new Date;f.setFullYear(f.getFullYear()-13);angular.extend(n,{minBirth:new Date(1900,1,1),maxBirth:f,user:{birthdate:null},postSignup:function(){u.signupForm.$pending=!0;t.post(appRoot+"/signup",u.user).then(function(){i.location.href=appRoot+"/me"},function(n){r.show(r.alert().parent(angular.element(document.querySelector("#content"))).clickOutsideToClose(!0).title("Server Error").textContent(n.statusText).ariaLabel("Error report").ok("Okay"));u.signupForm.$pending=!1})}})}]);angular.module("esarTraining").controller("MeCtrl",["$scope","$http","$mdPanel",function(n,t,i){function c(){return window.location.hash=window.location.hash.replace("/id_token","id_token"),window.location.hash.indexOf("id_token=")>=0&&window.location.hash.indexOf("session_state")>=0?u.signinRedirectCallback().then(function(n){return window.location.hash="",n}).catch(function(n){console.log(n)}):Promise.resolve()}function l(){return u.getUser().then(function(n){var t=null;return n==null?t=Promise.resolve():n.expires_in<30&&(t=u.clearStaleState()),t==null?n:t.then(function(){return u.signinRedirect()})})}function o(n,i){return r.$pending=!0,t.get(databaseRoot+n,{headers:{Authorization:"Bearer "+r.access_token}}).then(i,function(n){alert(n.statusText);r.$pending=!1})}function e(n){var t=r.data.trainingRecords[n];return t!==undefined}function f(n){return function(){return e(n)?2:0}}var r=n,u,h,s;Oidc.Log.logger=console;Oidc.Log.level=Oidc.Log.INFO;u=new Oidc.UserManager(oidcSettings);u.events.addAccessTokenExpiring(function(){console.log("token expiring")});u.events.addAccessTokenExpired(function(){console.log("token expired")});h=i.newPanelPosition().absolute().center();s=i.create({attachTo:angular.element(document.body),disableParentScroll:!1,template:'<div role="dialog" aria-label="Eat me!" layout="column" layout-align="center center"><div class="sar-dialog-content"><p>Loading ...<\/p><\/div><\/div>',hasBackdrop:!0,panelClass:"sar-dialog",position:h,trapFocus:!0,zIndex:150,clickOutsideToClose:!1,escapeToClose:!1,focusOnOpen:!0});angular.extend(n,{$pending:!0,initialized:!1,data:{user:{},emergencyContacts:0,contacts:[{type:"email",value:"george@tester.com"}]},tasks:[{title:"Contact Information",summary:"Address, Email, Phone Number",category:"personal",tester:function(){return r.data.contacts.length>1?1:0}},{title:"Emergency Contacts",summary:"Who to call in an emergency",category:"personal",tester:function(){return Math.min(r.data.emergencyContactCount,2)}},{title:"ICS-100 and ICS-700",summary:"FEMA required online courses",category:"online",blocked:!1,tester:function(){return(e("ICS-100")?1:0)+(e("ICS-700")?1:0)}},{title:"Course A",summary:"Evening orientation",category:"session",blocked:!1,tester:f("Course A")},{title:"Course B",summary:"Indoor navigation course",category:"session",blocked:!1,tester:f("Course B")},{title:"Background Check",summary:"Sheriff's Office application",category:"paperwork",blocked:!1,tester:function(){return r.data.user.backgroundKnown?2:0}},{title:"LFL Registration",summary:"For youth members",category:"paperwork",blocked:!1},{title:"Submit Photo",summary:"Submit portrait for ID card",category:"paperwork",blocked:!1,tester:function(){return r.data.user.photo?2:0}},{title:"First Aid / CPR",summary:"Obtain first aid and CPR training",category:"session",blocked:!1,tester:function(){return(e("Core/FirstAid")?1:0)+(e("Core/CPR")?1:0)}},{title:"Course C",summary:"Outdoor weekend - Intro to SAR",category:"session",blocked:!1,tester:f("Course C"),prereqs:["Course B"]},{title:"Course I",summary:"Outdoor weekend - Navigation",category:"session",blocked:!1,tester:f("Course I"),prereqs:["Course C"]},{title:"Course II",summary:"Outdoor weekend - Evaluation",category:"session",blocked:!1,tester:f("Course II"),prereqs:["Course I"]},{title:"Searcher First Aid",summary:"SAR specific first aid",category:"session",blocked:!1,tester:f("Searcher First Aid"),prereqs:["Course II"]},{title:"Course III",summary:"Outdoor weekend - mock mission",category:"session",blocked:!1,tester:f("Course III"),prereqs:["Searcher First Aid"]},],completedFilter:function(n){return function(t){return n==(t.progress==2)}},loadContacts:function(){return o("/members/"+r.data.user.id+"/contacts",function(n){r.data.contacts=n.data})},loadEmergencyStatus:function(){return o("/members/"+r.data.user.id+"/emergencycontacts/count",function(n){r.data.emergencyContactCount=n.data.count})},loadMember:function(){return o("/members/"+r.data.user.id,function(n){r.data.user=n.data;r.$pending=!1})},loadTraining:function(){return o("/members/"+r.data.user.id+"/trainingrecords",function(n){r.data.trainingRecords={};for(var t=0;t<n.data.length;t++)r.data.trainingRecords[n.data[t].course.name]=n.data[t];r.$pending=!1})},load:function(n){s.open();var t=getParameterByName("memberId");return r.data.user.id=t?t:n.profile.memberId,r.access_token=n.access_token,r.authMemberId=n.profile.memberId,r.loadMember().then(r.loadTraining).then(r.loadContacts).then(r.loadEmergencyStatus).then(function(){for(var t,n=0;n<r.tasks.length;n++)r.tasks[n].progress=r.tasks[n].tester?r.tasks[n].tester():-1;for(n=0;n<r.tasks.length;n++)t=r.tasks[n],t.blocked=!1,t.prereqs&&(t.blocked=t.prereqs.reduce(function(n,t){return n||!e(t)},t.blocked));s.close()})}});c().then(l).then(function(n){r.load(n)})}]);
//# sourceMappingURL=site.min.js.map